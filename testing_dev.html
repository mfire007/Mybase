<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AI АГЕНТ: ТЕРМИНАЛ</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        :root { --neon: #00f2ff; --bg: #0a0c10; --panel: #161b22; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Рабочая область */
        .viewport { flex: 1; position: relative; background: #000; overflow: hidden; cursor: crosshair; }
        #main-video { width: 100%; height: 100%; object-fit: contain; }

        /* РУЧНОЙ СКАНЕР (ЗОНА СЧИТЫВАНИЯ) */
        #scanner {
            position: absolute;
            border: 2px solid var(--neon);
            box-shadow: 0 0 15px var(--neon);
            background: rgba(0, 242, 255, 0.1);
            resize: both;
            overflow: hidden;
            min-width: 50px; min-height: 50px;
            cursor: move;
            z-index: 100;
        }
        .scan-label { position: absolute; top: -20px; left: 0; font-size: 10px; color: var(--neon); font-weight: bold; }

        /* Боковая панель */
        .sidebar { width: 380px; background: var(--panel); border-left: 1px solid #30363d; display: flex; flex-direction: column; padding: 20px; }
        .card { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #30363d; }
        
        .val-big { font-size: 64px; text-align: center; font-weight: 800; color: var(--neon); text-shadow: 0 0 20px rgba(0, 242, 255, 0.5); }
        .prediction { text-align: center; font-weight: bold; padding: 10px; border-radius: 8px; text-transform: uppercase; margin-top: 10px; }
        .up { background: rgba(0, 255, 136, 0.2); color: #00ff88; border: 1px solid #00ff88; }
        .down { background: rgba(255, 0, 85, 0.2); color: #ff0055; border: 1px solid #ff0055; }

        .log { flex: 1; overflow-y: auto; font-size: 13px; }
        .log-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #222; }

        button { width: 100%; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-main { background: var(--neon); color: #000; margin-bottom: 10px; }
        .btn-freeze { background: #30363d; color: #fff; font-size: 11px; }
        
        canvas#debug { display: none; }
    </style>
</head>
<body>

<div class="viewport" id="area">
    <video id="main-video" autoplay></video>
    <div id="scanner" style="top: 40%; left: 45%; width: 100px; height: 100px;">
        <span class="scan-label">ЗОНА СКАНЕРА (ТЯНИ ЗА УГОЛ)</span>
    </div>
    <canvas id="debug" width="150" height="150"></canvas>
</div>

<div class="sidebar">
    <button class="btn-main" id="start-btn">ПОДКЛЮЧИТЬ ТРАНСЛЯЦИЮ</button>
    <button class="btn-freeze" onclick="freezeAnimations()">БЛОКИРОВАТЬ АНИМАЦИИ (В КОНСОЛЬ)</button>

    <div class="card">
        <div style="font-size: 12px; color: #8b949e;">ТЕКУЩЕЕ ЧИСЛО</div>
        <div class="val-big" id="current-num">--</div>
        <div id="prediction" class="prediction">ОЖИДАНИЕ...</div>
    </div>

    <div class="card log" id="history">
        <div style="text-align:center; color:#555; margin-bottom:10px;">ЖУРНАЛ СОБЫТИЙ</div>
    </div>
</div>

<script>
    const scanner = document.getElementById('scanner');
    const video = document.getElementById('main-video');
    const historyBox = document.getElementById('history');
    const canvas = document.getElementById('debug');
    const ctx = canvas.getContext('2d');

    let lastVal = null;
    let currentPred = null;

    // --- 1. ПЕРЕМЕЩЕНИЕ СКАНЕРА (DRAG & DROP) ---
    let isDragging = false;
    scanner.onmousedown = (e) => { 
        if(e.offsetX > scanner.offsetWidth - 20) return; // Не мешать ресайзу
        isDragging = true; 
    };
    window.onmousemove = (e) => {
        if (!isDragging) return;
        scanner.style.left = (e.clientX - scanner.offsetWidth/2) + 'px';
        scanner.style.top = (e.clientY - scanner.offsetHeight/2) + 'px';
    };
    window.onmouseup = () => isDragging = false;

    // --- 2. ПОДКЛЮЧЕНИЕ ---
    document.getElementById('start-btn').onclick = async () => {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: { frameRate: 60 } });
        video.srcObject = stream;
        setInterval(fastScan, 1000); // Скан каждую секунду (быстро)
    };

    // --- 3. БЫСТРЫЙ СКАН ---
    async function fastScan() {
        if (!video.videoWidth) return;

        // Расчет координат относительно видео
        const rect = scanner.getBoundingClientRect();
        const videoRect = video.getBoundingClientRect();
        
        const scaleX = video.videoWidth / videoRect.width;
        const scaleY = video.videoHeight / videoRect.height;

        const sx = (rect.left - videoRect.left) * scaleX;
        const sy = (rect.top - videoRect.top) * scaleY;
        const sw = rect.width * scaleX;
        const sh = rect.height * scaleY;

        // Очистка картинки для OCR
        ctx.filter = 'contrast(200%) grayscale(100%) brightness(1.2)';
        ctx.drawImage(video, sx, sy, sw, sh, 0, 0, 150, 150);

        const { data: { text } } = await Tesseract.recognize(canvas, 'eng', {
            tessedit_char_whitelist: '0123456789'
        });

        const num = parseInt(text.trim());
        if (!isNaN(num) && num >= 2 && num <= 14 && num !== lastVal) {
            processData(num);
        }
    }

    // --- 4. ЛОГИКА ---
    function processData(num) {
        if (currentPred) {
            const win = (currentPred === 'ВВЕРХ' && num > lastVal) || (currentPred === 'ВНИЗ' && num < lastVal);
            const item = document.createElement('div');
            item.className = 'log-item';
            item.innerHTML = `<span>${lastVal}→${num}</span> <b style="color:${win?'#0f8':'#f05'}">${win?'ВИН':'ЛОСС'}</b>`;
            historyBox.prepend(item);
        }

        document.getElementById('current-num').innerText = num;
        
        const predEl = document.getElementById('prediction');
        if (num <= 8) {
            currentPred = 'ВВЕРХ';
            predEl.innerText = "ПРОГНОЗ: ВВЕРХ ↑";
            predEl.className = "prediction up";
        } else {
            currentPred = 'ВНИЗ';
            predEl.innerText = "ПРОГНОЗ: ВНИЗ ↓";
            predEl.className = "prediction down";
        }
        lastVal = num;
    }

    // --- 5. БЛОКИРОВКА АНИМАЦИЙ ---
    // Эту функцию нужно вставить в консоль разработчика (F12) на самом сайте с игрой
    function freezeAnimations() {
        const css = `
            * { transition: none !important; animation: none !important; }
            canvas, video { filter: blur(0px) !important; }
        `;
        alert("Скопируй код из консоли и вставь на вкладку с игрой!");
        console.log(`(function(){ 
            let style = document.createElement('style');
            style.innerHTML = '${css.replace(/\n/g, "")}';
            document.head.appendChild(style);
            console.log("Анимации сайта заблокированы.");
        })()`);
    }
</script>
</body>
</html>