<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBase OS v5.0 | MFIRE777</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
        
        /* СИСТЕМА АДАПТИВНЫХ ЦВЕТОВ */
        :root {
            --accent: #6366f1;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --text-main: #1e293b;
            --text-dim: #64748b;
            --glass: rgba(255, 255, 255, 0.7);
        }

        .theme-midnight {
            --accent: #10b981;
            --bg: #020617;
            --card: #0f172a;
            --border: #1e293b;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --glass: rgba(15, 23, 42, 0.8);
        }

        .theme-sunset {
            --accent: #f43f5e;
            --bg: #fff1f2;
            --card: #ffffff;
            --border: #ffe4e6;
            --text-main: #4c0519;
            --text-dim: #9f1239;
            --glass: rgba(255, 255, 255, 0.8);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg); 
            color: var(--text-main);
            transition: background 0.4s ease, color 0.4s ease;
        }

        .card-adaptive { 
            background-color: var(--card); 
            border: 1px solid var(--border);
            color: var(--text-main);
        }

        .text-dim { color: var(--text-dim); }
        .accent-bg { background-color: var(--accent); }
        .accent-text { color: var(--accent); }
        .glass-blur { backdrop-filter: blur(20px); background-color: var(--glass); }

        /* Сетка */
        .file-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); 
            gap: 1rem; 
        }
        @media (max-width: 640px) { .file-grid { grid-template-columns: repeat(3, 1fr); gap: 0.75rem; } }

        /* Плавные переходы */
        .modal-anim { animation: appear 0.25s cubic-bezier(0, 0, 0.2, 1); }
        @keyframes appear { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .loader-spin { 
            width: 32px; height: 32px; 
            border: 3px solid var(--border); border-top-color: var(--accent); 
            border-radius: 50%; animation: spin 0.8s linear infinite; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <header class="h-20 flex items-center justify-between px-6 shrink-0 border-b z-50" style="border-color: var(--border)">
        <div class="flex items-center gap-4">
            <div class="w-11 h-11 accent-bg rounded-2xl flex items-center justify-center text-white shadow-sm" onclick="fetchFiles('')">
                <i data-lucide="cpu" size="20"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg leading-none italic">MyBase OS</h1>
                <p class="text-[10px] font-bold uppercase tracking-widest text-dim mt-1">Dev: MFIRE777</p>
            </div>
        </div>
        
        <div class="flex gap-2">
            <button onclick="openModal('userModal')" class="w-10 h-10 flex items-center justify-center rounded-xl card-adaptive hover:scale-105 transition">
                <i data-lucide="palette" size="18"></i>
            </button>
            <button id="adminBtn" onclick="openModal('authModal')" class="w-10 h-10 flex items-center justify-center rounded-xl bg-slate-900 text-white hover:scale-105 transition">
                <i data-lucide="terminal" size="18"></i>
            </button>
        </div>
    </header>

    <nav id="breadcrumb" class="px-6 py-4 flex items-center gap-2 text-[10px] font-bold uppercase tracking-tighter text-dim no-scrollbar overflow-x-auto border-b" style="border-color: var(--border)"></nav>

    <main class="flex-1 overflow-y-auto p-6">
        <div id="loader" class="hidden flex flex-col items-center justify-center py-20 gap-4">
            <div class="loader-spin"></div>
            <p class="text-[10px] font-bold uppercase text-dim tracking-widest">Обработка данных...</p>
        </div>
        <div id="file-grid" class="file-grid"></div>
    </main>

    <div id="authModal" class="fixed inset-0 z-[100] hidden items-center justify-center glass-blur p-4">
        <div class="w-full max-w-xs text-center modal-anim">
            <div class="w-16 h-16 accent-bg text-white rounded-[2rem] flex items-center justify-center mx-auto mb-6">
                <i data-lucide="fingerprint" size="32"></i>
            </div>
            <h3 class="text-xl font-bold mb-6">Админ-доступ</h3>
            <input type="password" id="passInp" maxlength="4" class="w-full p-5 card-adaptive rounded-3xl mb-4 outline-none text-center text-2xl tracking-[0.8em] font-bold" placeholder="••••">
            <div class="grid grid-cols-2 gap-3">
                <button onclick="checkPass()" class="py-4 accent-bg text-white rounded-2xl font-bold">Вход</button>
                <button onclick="closeModals()" class="py-4 card-adaptive rounded-2xl font-bold">Отмена</button>
            </div>
        </div>
    </div>

    <div id="userModal" class="fixed inset-0 z-[100] hidden items-center justify-center glass-blur p-4">
        <div class="card-adaptive w-full max-w-sm rounded-[2.5rem] p-8 modal-anim border-none">
            <h3 class="text-lg font-bold mb-6">Персонализация</h3>
            <div class="grid grid-cols-2 gap-3 mb-8">
                <button onclick="setTheme('light')" class="p-4 border rounded-2xl text-[10px] font-bold bg-white text-slate-900">LIGHT</button>
                <button onclick="setTheme('midnight')" class="p-4 border rounded-2xl text-[10px] font-bold bg-slate-900 text-white">MIDNIGHT</button>
                <button onclick="setTheme('sunset')" class="p-4 border rounded-2xl text-[10px] font-bold bg-rose-500 text-white">SUNSET</button>
                <button onclick="setTheme('ocean')" class="p-4 border rounded-2xl text-[10px] font-bold bg-sky-500 text-white">OCEAN</button>
            </div>
            
            <div class="p-6 bg-slate-500/5 rounded-[2rem] text-center border" style="border-color: var(--border)">
                <p class="text-[9px] font-bold text-dim uppercase tracking-widest mb-2">Build Info</p>
                <h4 class="font-bold text-base">MFIRE777 OS v5.0.1</h4>
                <p class="text-xs text-dim mt-1 italic">"Stability is a journey, not a destination."</p>
            </div>
            <button onclick="closeModals()" class="w-full mt-6 py-4 card-adaptive rounded-2xl font-bold text-xs uppercase opacity-50">Закрыть</button>
        </div>
    </div>

    <div id="adminPanel" class="fixed inset-0 z-[100] hidden items-center justify-center glass-blur p-4">
        <div class="card-adaptive w-full max-w-md rounded-[2.5rem] p-8 modal-anim border-none">
            <div class="flex justify-between items-center mb-8">
                <h3 class="font-bold text-xl accent-text">Console v5.0</h3>
                <button onclick="logout()" class="text-[10px] font-bold text-rose-500 uppercase">Выйти</button>
            </div>
            <div class="space-y-4">
                <div class="relative">
                    <i data-lucide="key" class="absolute left-4 top-4 text-dim" size="18"></i>
                    <input type="password" id="ghToken" class="w-full p-4 pl-12 card-adaptive rounded-2xl outline-none text-sm" placeholder="GitHub Access Token">
                </div>
                <div class="border-2 border-dashed rounded-3xl p-8 text-center cursor-pointer transition-all hover:bg-slate-500/5" style="border-color: var(--border)" onclick="document.getElementById('fileInp').click()">
                    <i data-lucide="plus-circle" class="mx-auto mb-2 text-dim"></i>
                    <p id="fileLabel" class="text-xs font-bold text-dim uppercase">Клик для выбора файла</p>
                    <input type="file" id="fileInp" class="hidden" onchange="onFilePicked(event)">
                </div>
                <button onclick="uploadNow()" id="upBtn" class="w-full py-5 accent-bg text-white rounded-2xl font-bold shadow-lg shadow-indigo-500/20">Опубликовать</button>
            </div>
            <button onclick="closeModals()" class="w-full mt-4 py-2 text-[10px] font-bold text-dim uppercase">Закрыть</button>
        </div>
    </div>

    <div id="actionSheet" class="fixed inset-0 z-[100] hidden items-end sm:items-center justify-center glass-blur p-4">
        <div class="card-adaptive w-full max-w-sm rounded-t-[2.5rem] sm:rounded-[2.5rem] p-8 modal-anim border-none">
            <div id="actionIcon" class="w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center"></div>
            <h3 id="actionTitle" class="text-center font-bold mb-1 text-lg truncate px-4">file_name</h3>
            <p id="actionSize" class="text-center text-[10px] text-dim font-bold uppercase mb-8">14.5 KB</p>
            <div class="grid gap-3">
                <button id="btnPlay" class="w-full py-4 accent-bg text-white rounded-2xl font-bold flex items-center justify-center gap-2">
                    <i data-lucide="external-link" size="18"></i> ЗАПУСТИТЬ
                </button>
                <a id="btnDownload" download class="w-full py-4 bg-slate-500/10 rounded-2xl font-bold flex items-center justify-center gap-2">
                    <i data-lucide="download-cloud" size="18"></i> СКАЧАТЬ
                </a>
                <button onclick="closeModals()" class="mt-2 py-4 text-xs font-bold text-dim uppercase">Отмена</button>
            </div>
        </div>
    </div>

    <script>
        const USER = 'mfire007', REPO = 'Mybase';
        let currentPath = '', base64File = null, isLogged = false;

        function toast(t, e=false) { 
            Toastify({text:t, duration:2500, style:{background:e?"#ef4444":"var(--accent)", borderRadius:"15px", boxShadow:"none"}}).showToast(); 
        }

        async function fetchFiles(path = '') {
            currentPath = path;
            const grid = document.getElementById('file-grid'), loader = document.getElementById('loader');
            grid.innerHTML = ''; loader.classList.remove('hidden');
            updateBread(path);

            try {
                const token = document.getElementById('ghToken').value || localStorage.getItem('gh_token');
                const h = token ? { 'Authorization': `token ${token}` } : {};
                const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${path}`, { headers: h });
                if(!res.ok) throw new Error();
                const data = await res.json();
                
                loader.classList.add('hidden');
                data.sort((a,b) => (b.type==='dir')-(a.type==='dir')).forEach(f => {
                    const isD = f.type === 'dir';
                    const card = document.createElement('div');
                    card.className = "card-adaptive p-5 rounded-3xl flex flex-col items-center justify-center text-center cursor-pointer hover:border-indigo-400 transition-all";
                    card.innerHTML = `
                        <div class="w-11 h-11 ${isD?'bg-indigo-500/10 text-indigo-500':'bg-slate-500/10 text-dim'} rounded-2xl flex items-center justify-center mb-3">
                            <i data-lucide="${isD?'folder-closed':'file-code'}" size="20"></i>
                        </div>
                        <span class="text-[9px] font-bold truncate w-full px-1 uppercase tracking-tighter leading-none">${f.name}</span>
                    `;
                    card.onclick = () => isD ? fetchFiles(f.path) : openAction(f);
                    grid.appendChild(card);
                });
                lucide.createIcons();
            } catch(e) { 
                loader.classList.add('hidden');
                toast("Сбой соединения или API", true); 
            }
        }

        function openAction(f) {
            const ext = f.name.split('.').pop().toLowerCase();
            document.getElementById('actionTitle').innerText = f.name;
            document.getElementById('actionSize').innerText = (f.size / 1024).toFixed(1) + " KB";
            document.getElementById('actionIcon').className = `w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center ${ext==='html'?'bg-emerald-500/10 text-emerald-500':'bg-slate-500/10 text-dim'}`;
            document.getElementById('actionIcon').innerHTML = `<i data-lucide="${ext==='html'?'globe':'file'}"></i>`;
            
            document.getElementById('btnPlay').onclick = () => {
                const url = ext === 'html' ? `https://htmlpreview.github.io/?https://github.com/${USER}/${REPO}/blob/main/${f.path}` : f.html_url;
                window.open(url, '_blank');
            };
            document.getElementById('btnDownload').href = f.download_url;
            openModal('actionSheet');
            lucide.createIcons();
        }

        function setTheme(t) {
            document.body.className = t === 'light' ? '' : 'theme-' + t;
            localStorage.setItem('mybase_theme', t);
            toast("Тема: " + t.toUpperCase());
        }

        function openModal(id) { 
            document.querySelectorAll('.glass-blur').forEach(m => m.classList.add('hidden')); 
            document.getElementById(id).classList.remove('hidden'); 
            document.getElementById(id).classList.add('flex');
            lucide.createIcons();
        }

        function closeModals() { document.querySelectorAll('.glass-blur').forEach(m => m.classList.add('hidden')); }

        function checkPass() {
            if(document.getElementById('passInp').value === '1234') {
                isLogged = true;
                openModal('adminPanel');
                toast("Доступ разрешен");
            } else toast("Код неверный", true);
        }

        function logout() {
            isLogged = false;
            document.getElementById('ghToken').value = '';
            closeModals();
            toast("Сессия завершена");
        }

        function onFilePicked(e) {
            const file = e.target.files[0];
            if(!file) return;
            document.getElementById('fileLabel').innerText = file.name;
            const reader = new FileReader();
            reader.onload = (ev) => base64File = ev.target.result.split(',')[1];
            reader.readAsDataURL(file);
        }

        async function uploadNow() {
            const t = document.getElementById('ghToken').value, file = document.getElementById('fileInp').files[0];
            if(!t || !base64File) return toast("Нужен Token и файл", true);
            const path = (currentPath ? currentPath + '/' : '') + file.name;
            const btn = document.getElementById('upBtn');
            btn.disabled = true; btn.innerText = "ПУБЛИКАЦИЯ...";
            try {
                const url = `https://api.github.com/repos/${USER}/${REPO}/contents/${path}`;
                let sha = "";
                const check = await fetch(url, { headers: { 'Authorization': `token ${t}` } });
                if(check.ok) { const d = await check.json(); sha = d.sha; }
                const res = await fetch(url, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${t}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: "Admin Upload", content: base64File, sha: sha || undefined })
                });
                if(res.ok) { toast("Файл опубликован!"); fetchFiles(currentPath); closeModals(); }
                else toast("Ошибка GitHub", true);
            } catch(e) { toast("Ошибка сети", true); } finally { btn.disabled = false; btn.innerText = "ОПУБЛИКОВАТЬ"; }
        }

        function updateBread(path) {
            const b = document.getElementById('breadcrumb');
            let h = `<span onclick="fetchFiles('')" class="cursor-pointer hover:accent-text">MAIN_ROOT</span>`;
            if(path) path.split('/').forEach(p => h += ` <i data-lucide="slash" size="8" class="opacity-20"></i> <span class="accent-text">${p}</span>`);
            b.innerHTML = h; lucide.createIcons();
        }

        // Авто-тема при загрузке
        const savedTheme = localStorage.getItem('mybase_theme');
        if(savedTheme) setTheme(savedTheme);

        fetchFiles();
    </script>
</body>
</html>
